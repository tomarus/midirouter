#include "fifo.h"

typedef struct {
	u8 buf[OUTPUT_BUFFER_LENGTH];
	u8 rpos;
	u8 wpos;
} fifo;

void fifo_add_byte(fifo *f, u8 b) {
	f->wpos++;
	if (f->wpos>OUTPUT_BUFFER_LENGTH-1) {
		f->wpos=0;
	}
	f->buf[f->wpos] = b;
}

u8 fifo_read_byte(fifo *f) {
	f->rpos++;
	if (f->rpos>OUTPUT_BUFFER_LENGTH-1) {
		f->rpos=0;
	}
	return f->buf[f->rpos];
}

u8 fifo_is_empty(fifo *f) {
	return f->rpos == f->wpos;
}

u8 fifo_is_full(fifo *f) {
	return ((f->rpos-1)&(OUTPUT_BUFFER_LENGTH-1)) == f->wpos;
}
